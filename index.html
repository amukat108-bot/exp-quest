<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EXP Quest</title>
  <style>
    body{margin:0;font-family:-apple-system,system-ui;background:#0b0f19;color:#e7eefc}
    .wrap{max-width:900px;margin:0 auto;padding:18px}
    textarea{width:100%;min-height:140px;border-radius:12px;border:1px solid rgba(255,255,255,.15);padding:12px;background:rgba(255,255,255,.06);color:#e7eefc}
    button{margin-top:10px;padding:12px 14px;border:0;border-radius:12px;font-weight:800;cursor:pointer}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    label{display:flex;gap:8px;align-items:center;padding:8px 10px;border:1px solid rgba(255,255,255,.12);border-radius:999px;background:rgba(255,255,255,.04)}
    #buddyWrap{position:fixed;right:16px;bottom:16px;display:flex;gap:12px;align-items:flex-end}
    #buddy{width:88px;height:88px;border-radius:22px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04)}
    #bubble{width:min(420px,calc(100vw - 140px));padding:12px;border-radius:18px;border:1px solid rgba(255,255,255,.12);background:rgba(15,21,36,.92)}
    #chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);cursor:pointer}
    .muted{color:rgba(231,238,252,.7);font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:0 0 8px;">EXP Quest</h1>
    <div class="muted" id="status">Lv 10 / EXP 1200</div>

    <textarea id="logInput" placeholder="・自炊
・SNSを我慢
・読書30分
・気づき
..."></textarea>

    <div class="row">
      <label><input type="checkbox" id="tNoSNS">SNS使わなかった</label>
      <label><input type="checkbox" id="tDeepWork">深集中</label>
      <label><input type="checkbox" id="tRisk">怖いことに踏み込んだ</label>
    </div>

    <button id="btnSubmit">査定してEXP付与</button>
    <button id="btnReset">初期化</button>

    <pre id="history" class="muted" style="white-space:pre-wrap;margin-top:12px;"></pre>
  </div>

  <div id="buddyWrap">
    <canvas id="buddy" width="220" height="220"></canvas>
    <div id="bubble">
      <div class="muted">Amo</div>
      <div id="buddyText">相棒Amoだ。入力して。</div>
      <div id="chips"></div>
    </div>
  </div>

<script>
const $ = (id)=>document.getElementById(id);
const KEY="expquest_min_v1";

function load(){ try{return JSON.parse(localStorage.getItem(KEY))||{exp:1200,h:[]};}catch{return {exp:1200,h:[]};} }
function save(s){ localStorage.setItem(KEY, JSON.stringify(s)); }
function lv(exp){ return exp>=1500?11:10; }

function setBuddy(text, chips=[]){
  $("buddyText").textContent=text;
  const wrap=$("chips"); wrap.innerHTML="";
  chips.forEach(c=>{
    const d=document.createElement("div");
    d.className="chip"; d.textContent=c.label;
    d.onclick=c.onClick; wrap.appendChild(d);
  });
}

function assess(text){
  let gained=40;
  if (text.includes("自炊")) gained+=20;
  if (text.includes("読書")) gained+=40;
  if ($("tNoSNS").checked) gained+=120;
  if ($("tDeepWork").checked) gained+=70;
  if ($("tRisk").checked) gained+=90;
  // metal (やや出る)
  const p = 0.18 + ($("tDeepWork").checked?0
